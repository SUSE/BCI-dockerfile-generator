<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>BCI build recipe generator &#8212; bci-build-templates  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Adding and Modifying Container Images" href="adding_containers.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="bci-build-recipe-generator">
<h1>BCI build recipe generator<a class="headerlink" href="#bci-build-recipe-generator" title="Link to this heading">¶</a></h1>
<p>This repository contains the scripts to generate the build recipes (Dockerfiles
or <a class="reference external" href="https://github.com/OSInside/kiwi">kiwi</a> build descriptions) to build the
BCI development project in the <a class="reference external" href="https://build.opensuse.org/project/subprojects/devel:BCI">Open Build Service</a>.</p>
<p>Find the latest fully rendered documentation <a class="reference external" href="https://opensource.suse.com/BCI-dockerfile-generator/">here</a>.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">¶</a></h2>
<p>You will need the following tools:</p>
<ul class="simple">
<li><p>Python 3.10 or later</p></li>
<li><p><a class="reference external" href="https://python-poetry.org/">poetry</a></p></li>
<li><p><a class="reference external" href="https://github.com/openSUSE/osc/">osc</a> installed and configured to reach
<a class="reference external" href="https://build.opensuse.org/">OBS</a> by default.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">python-dnf</span></code> installed via your system’s package manager (if you want to
touch the .Net images)</p></li>
</ul>
<p>To get started, clone this repository and run <strong class="command">poetry install</strong> in its
root directory.</p>
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>This repository contains two major components:</p>
<ol class="arabic simple">
<li><p>templating logic to autogenerate the <code class="file docutils literal notranslate"><span class="pre">Dockerfile</span></code> and kiwi build
descriptions for SLE BCI (see <a class="reference internal" href="api.html#module-bci_build" title="bci_build"><code class="xref py py-mod docutils literal notranslate"><span class="pre">bci_build</span></code></a>) including an updater for
our .Net images (see <a class="reference internal" href="api.html#module-dotnet" title="dotnet"><code class="xref py py-mod docutils literal notranslate"><span class="pre">dotnet</span></code></a>).</p></li>
<li><p>Github automation to render the templates into separate branches and
synchronize them to the Open Build Service (see <a class="reference internal" href="api.html#module-staging" title="staging"><code class="xref py py-mod docutils literal notranslate"><span class="pre">staging</span></code></a>).</p></li>
</ol>
</section>
<section id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Link to this heading">¶</a></h2>
<p>To contribute a new container or modify an existing one, please check the
chapter <a class="reference internal" href="adding_containers.html#adding-and-modifying-container-images"><span class="std std-ref">Adding and Modifying Container Images</span></a>.</p>
<p>Before submitting your changes, please format your source code with <a class="reference external" href="https://docs.astral.sh/ruff/">ruff</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>ruff<span class="w"> </span>format
<span class="c1"># reorder imports:</span>
poetry<span class="w"> </span>run<span class="w"> </span>ruff<span class="w"> </span>check<span class="w"> </span>--fix
</pre></div>
</div>
<p>Additionally, run the unit tests and check whether the documentation builds
(additional points if you update it):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># tests</span>
poetry<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>-vv
<span class="c1"># docs</span>
poetry<span class="w"> </span>run<span class="w"> </span>sphinx-build<span class="w"> </span>-M<span class="w"> </span>html<span class="w"> </span><span class="nb">source</span><span class="w"> </span>build<span class="w"> </span>-W
</pre></div>
</div>
<section id="documentation-readmes">
<h3>Documentation - READMEs<a class="headerlink" href="#documentation-readmes" title="Link to this heading">¶</a></h3>
<p>We are using Jinja2 templates to create Markdown formatted <code class="file docutils literal notranslate"><span class="pre">README.md</span></code>
files of each container.</p>
<p>To create a new <code class="file docutils literal notranslate"><span class="pre">README.md</span></code>, create a new file in the location
<code class="file docutils literal notranslate"><span class="pre">src/bci_build/package/$name/README.md.j2</span></code> where <code class="docutils literal notranslate"><span class="pre">$name</span></code> is the
container image name
(<a class="reference internal" href="api.html#bci_build.package.BaseContainerImage.name" title="bci_build.package.BaseContainerImage.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">name</span></code></a>). Add a markdown
formatted README that explains the specifics of using this container
images. Focus on anything container specific, like volumes, the behavior of the
entrypoint and differences to the package in SLES/SLFO/Tumbleweed. If there is
upstream/downstream documentation, refer to it if applicable.</p>
<p>There are additionally the following helper templates, to enhance the READMEs:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">licensing_and_eula.j2</span></code>: Adds a standard licencing &amp; EULA footer. <strong>MUST</strong>
be included at the bottom of every README.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">badges.j2</span></code>: Adds a Redistributable &amp; optional supportlevel badge. <strong>MUST</strong>
be included at the top of every README.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">access_protected_images.j2</span></code>: Explains how to access an image behind the
paywall. It only needs to be added at the bottom of paywalled images.</p></li>
</ul>
<p>You can include the helpers via the following directive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s1">&#39;licensing_and_eula.j2&#39;</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>The <code class="file docutils literal notranslate"><span class="pre">README.md.j2</span></code> template is rendered with the respective
<a class="reference internal" href="api.html#bci_build.package.BaseContainerImage" title="bci_build.package.BaseContainerImage"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseContainerImage</span></code></a> being passed as the parameter
<code class="docutils literal notranslate"><span class="pre">image</span></code> to the templating engine. This allows you to use all properties of the
<a class="reference internal" href="api.html#bci_build.package.BaseContainerImage" title="bci_build.package.BaseContainerImage"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseContainerImage</span></code></a> in the README, e.g. the image
title (<a class="reference internal" href="api.html#bci_build.package.BaseContainerImage.title" title="bci_build.package.BaseContainerImage.title"><code class="xref py py-attr docutils literal notranslate"><span class="pre">title</span></code></a>) or the reference
(<a class="reference internal" href="api.html#bci_build.package.BaseContainerImage.pretty_reference" title="bci_build.package.BaseContainerImage.pretty_reference"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pretty_reference</span></code></a>).</p>
</section>
</section>
<section id="entrypoints">
<h2>Entrypoints<a class="headerlink" href="#entrypoints" title="Link to this heading">¶</a></h2>
<p>The projects currently provides two entry points. The first is the package build
description “dumper” called <code class="docutils literal notranslate"><span class="pre">package</span></code>. It writes the build description of a
single container image into a specified directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>package<span class="w"> </span>postgres-12-sp4<span class="w"> </span>~/tmp/postgres/
</pre></div>
</div>
<p>The first argument is the name of the container image, this is the concatenation
of the image name (<a class="reference internal" href="api.html#bci_build.package.BaseContainerImage.name" title="bci_build.package.BaseContainerImage.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">name</span></code></a>) and
the operating system version
(<a class="reference internal" href="api.html#bci_build.package.BaseContainerImage.os_version" title="bci_build.package.BaseContainerImage.os_version"><code class="xref py py-attr docutils literal notranslate"><span class="pre">os_version</span></code></a>).</p>
<p>The second entry point is the github automation bot, which is not intended for
end user usage. You can find some details in the chapter <a class="reference internal" href="staging_bot.html#staging-bot"><span class="std std-ref">Staging Bot</span></a>.</p>
</section>
<section id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Link to this heading">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="adding_containers.html">Adding and Modifying Container Images</a><ul>
<li class="toctree-l2"><a class="reference internal" href="adding_containers.html#adding-files-to-the-image">Adding files to the Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding_containers.html#automatic-package-version-substitution">Automatic Package Version Substitution</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding_containers.html#installing-packages-into-the-container-image">Installing Packages into the Container Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding_containers.html#applying-additional-changes-to-your-image">Applying additional changes to your Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding_containers.html#new-package-checklist">New Package Checklist</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="staging_bot.html">Staging Bot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="staging_bot.html#branch-setup">Branch setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="staging_bot.html#project-setup">Project Setup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-bci_build"><code class="xref py py-mod docutils literal notranslate"><span class="pre">bci_build</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-bci_build.package"><code class="xref py py-mod docutils literal notranslate"><span class="pre">bci_build.package</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-bci_build.package.versions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">bci_build.package.versions</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-bci_build.templates"><code class="xref py py-mod docutils literal notranslate"><span class="pre">bci_build.templates</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-dotnet"><code class="xref py py-mod docutils literal notranslate"><span class="pre">dotnet</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-staging"><code class="xref py py-mod docutils literal notranslate"><span class="pre">staging</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-staging.bot"><code class="xref py py-mod docutils literal notranslate"><span class="pre">staging.bot</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-staging.build_result"><code class="xref py py-mod docutils literal notranslate"><span class="pre">staging.build_result</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-staging.project_setup"><code class="xref py py-mod docutils literal notranslate"><span class="pre">staging.project_setup</span></code> module</a></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="indices-and-tables">
<h2>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="#">bci-build-templates</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="adding_containers.html">Adding and Modifying Container Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="staging_bot.html">Staging Bot</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
      <li>Next: <a href="adding_containers.html" title="next chapter">Adding and Modifying Container Images</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, SUSE LLC.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>